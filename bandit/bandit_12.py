#!/usr/bin/python3.9

"""This script is a solution to Overthewire Bandit level 12."""

import time
import paramiko

s = paramiko.SSHClient()
s.set_missing_host_key_policy(paramiko.AutoAddPolicy())

s.connect(
    "bandit.labs.overthewire.org", 
    port=2220, 
    username="bandit12",
    password="JVNBBFSmZwKKOP0XbFXOoW8chDz5yVRv",
    look_for_keys=False, 
    allow_agent=False)

cmd = [
    "TDIR=`mktemp -d`",
    "xxd -r data.txt $TDIR/file1.gz",
    "gzip -d -k -c $TDIR/file1.gz > $TDIR/file2.bz2",
    "bunzip2 -d -k -c $TDIR/file2.bz2 > $TDIR/file3.gz",
    "gzip -d -k -c $TDIR/file3.gz > $TDIR/file4.tar",
    "tar -kO -xf $TDIR/file4.tar > $TDIR/file5.tar",
    "tar -kO -xf $TDIR/file5.tar > $TDIR/file6.bz2",
    "bunzip2 -d -k -c $TDIR/file6.bz2 > $TDIR/file7.tar",
    "tar -kO -xf $TDIR/file7.tar > $TDIR/file8.gz",
    "gzip -d -k -c $TDIR/file8.gz",
    "rm -r $TDIR"
]

stdin, stdout, stderr = s.exec_command(';'.join(cmd))

password = stdout.read().decode('utf-8')
password = password.strip().split(" ")[-1]

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL]",
        f"[Password({len(password)}): {password}]")

stdin.close(); s.close()
