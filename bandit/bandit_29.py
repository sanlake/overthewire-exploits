#!/usr/bin/python3.9

"""This script is a solution to Overthewire Bandit level 29."""

from git import Repo
from os import environ
from tempfile import TemporaryDirectory
from shutil import which

if which("sshpass") is None:
    exit("[ERROR] sshpass command not found.")

temp_dir = TemporaryDirectory()

environ['GIT_SSH_COMMAND'] = ' '.join([
    "sshpass -p tQKvmcwNYcFS6vmPHIUSI3ShmsrQZK8S", 
    "ssh -o StrictHostKeyChecking=no",
    "-o UserKnownHostsFile=/dev/null -p 2220"])

path = "/home/bandit29-git/repo"
remote = f"ssh://bandit29-git@bandit.labs.overthewire.org{path}"

repo = Repo.clone_from(remote, temp_dir.name)

repo.git.checkout('dev')

with open(temp_dir.name+"/README.md", 'r') as f:
    password = f.read().strip()
    password = password.split(" ")[-1]

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL]",
        f"[Password({len(password)}): {password}]")

temp_dir.cleanup()
