#!/usr/bin/python3.9

"""This script is a solution to Overthewire Bandit level 30."""

from git import Repo
from tempfile import TemporaryDirectory
from shutil import which

if which("sshpass") is None:
    exit("[ERROR] sshpass command not found.")

temp_dir = TemporaryDirectory()

git_ssh_command = ' '.join([
    "sshpass -p xbhV3HpNGlTIdnjUrdAlPzc2L6y9EOnS", 
    "ssh -o StrictHostKeyChecking=no",
    "-o UserKnownHostsFile=/dev/null -p 2220"])

path = "/home/bandit30-git/repo"
remote = f"ssh://bandit30-git@bandit.labs.overthewire.org{path}"

repo = Repo.clone_from(remote, temp_dir.name, env={"GIT_SSH_COMMAND":git_ssh_command})

password = repo.git.show('secret')

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL]",
        f"[Password({len(password)}): {password}]")

temp_dir.cleanup()
