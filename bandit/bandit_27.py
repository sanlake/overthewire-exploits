#!/usr/bin/python3.9

"""This script is a solution to Overthewire Bandit level 27."""

from git import Repo
from tempfile import TemporaryDirectory
from shutil import which

if which("sshpass") is None:
    exit("[ERROR] sshpass command not found.")

temp_dir = TemporaryDirectory()

git_ssh_command = ' '.join([
    "sshpass -p YnQpBuifNMas1hcUFk70ZmqkhUU2EuaS", 
    "ssh -o StrictHostKeyChecking=no",
    "-o UserKnownHostsFile=/dev/null -p 2220"])

path = "/home/bandit27-git/repo"
remote = f"ssh://bandit27-git@bandit.labs.overthewire.org{path}"

Repo.clone_from(remote, temp_dir.name, env={"GIT_SSH_COMMAND":git_ssh_command})

with open(temp_dir.name+"/README", 'r') as f:
    password = f.read().strip()
    password = password.split(" ")[-1]

if password and password.isalnum() and len(password) == 32:
    print("[PASSWORD]", password)
else:
    print(
        f"[FAIL]",
        f"[Password({len(password)}): {password}]")

temp_dir.cleanup()
